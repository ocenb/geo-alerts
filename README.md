# Geo Alerts

Система геооповещений, обеспечивающая проверку местоположения пользователей и асинхронную отправку вебхуков на новостной портал при попадании в опасные зоны, а также возможность управления инцидентами.

## Реализованный функционал

- **Геолокация и мониторинг:**
  - Проверка вхождения координат пользователя в радиус опасной зоны
- **Система уведомлений:**
  - Асинхронная отправка HTTP-вебхуков во внешние системы при обнаружении опасности
  - Гарантированная доставка уведомлений с механизмом автоматических повторных попыток
- **Управление инцидентами (для операторов с API-Key):**
  - Регистрация опасных зон с заданными географическими координатами и радиусом действия
  - Получение, обновление и деактивация инцидентов
  - Кэширование активных зон
- **Аналитика:**
  - Сбор статистики уникальных пользователей, зафиксированных в зоне инцидента
- **Валидация данных:**
  - Проверка правильности входных данных.
- **Логирование:**
  - Настроено логирование событий сервиса.
- **Тестирование:**
  - Реализованы Unit-тесты бизнес-логики и E2E-тесты всего приложения.

## Стек технологий

Go, PostgreSQL, Redis, Docker, Swagger, Gin, asynq, pgx, goose, mockery.

## Запуск проекта

**Запуск сервера-заглушки для приема вебхуков:**

```bash
make up-webhook-mock || go run cmd/webhook-mock/main.go
```

По умолчанию запускается на порту 9090

Настройка Ngrok (может потребоваться VPN):

```bash
ngrok http 9090
```

Полученный URL нужно указать в переменной `WEBHOOK_URL` в файле `.env`.

**Запуск основного сервиса:**

```bash
make up-build || docker compose up -d --build
```

- Миграции применяются автоматически при запуске контейнера.
- API: `http://localhost:8080`
- Документация: `http://localhost:8080/api/v1/docs/index.html`
- Postman-коллекция: файл `postman.json`

**Остановка:**

```bash
make down || docker compose down
```

## Тестирование

- **Unit:**
  ```bash
  make test-unit
  ```
- **E2E:**
  ```bash
  make test-e2e
  ```
  Используется `docker-compose.test.yaml` для тестового окружения.

## Структура кода

```
├── cmd/
│   ├── geo-alerts/    # Основное приложение сервиса
│   └── webhook-mock/  # HTTP-сервер-заглушка
├── docs/              # Swagger-документация
├── internal/
│   ├── config/        # Конфигурация приложения
│   ├── domain/
│   │   ├── errs/      # Доменные ошибки
│   │   └── models/    # Модели данных
│   ├── handlers/      # Обработчики HTTP-запросов
│   ├── http/          # Атрибуты логирования
│   │   ├── response/  # Ответы HTTP
│   │   ├── server/    # HTTP-сервер
│   │   └── utils/     # Утилиты для работы с HTTP
│   ├── logger/        # Настройка логирования
│   ├── middlewares/   # HTTP middlewares
│   ├── queues/        # Абстракции для работы с очередью (Redis)
│   ├── repos/         # Репозитории (работа с базой данных)
│   ├── services/      # Сервисы (бизнес-логика)
│   ├── storage/       # Абстракции для работы с БД (PostgreSQL) и кэшем (Redis)
│   └── utils/         # Утилиты
├── migrations/        # Скрипты миграций
└── tests/             # E2E-тесты
```
